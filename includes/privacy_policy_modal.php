<!-- Privacy Policy Modal -->
<div id="privacyPolicyModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center; overflow-y: auto; padding: 2rem;">
    <div style="background: white; border-radius: 20px; width: 90%; max-width: 700px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); margin: auto; max-height: 90vh; display: flex; flex-direction: column;">
        <!-- Header -->
        <div style="padding: 2rem 2.5rem 1.5rem; border-bottom: 2px solid var(--light-blue);">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue)); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-shield-alt" style="color: white; font-size: 1.5rem;"></i>
                </div>
                <div>
                    <h2 style="margin: 0; color: var(--dark-blue); font-size: 1.75rem;">Privacy Policy</h2>
                    <p style="margin: 0.25rem 0 0 0; color: var(--gray); font-size: 0.9rem;">Golden Treasure Baptist Academy Portal</p>
                </div>
            </div>
        </div>
        
        <!-- Content -->
        <div style="padding: 2rem 2.5rem; overflow-y: auto; flex: 1;">
            <div style="background: #f8f9fa; border-left: 4px solid var(--primary-blue); padding: 1rem 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <p style="margin: 0; color: var(--dark-blue); font-weight: 600;">
                    <i class="fas fa-info-circle" style="color: var(--primary-blue);"></i> 
                    Please read and accept our Privacy Policy to continue using the GTBA Portal.
                </p>
            </div>
            
            <div style="line-height: 1.8; color: #333; font-size: 0.95rem;">
                <h3 style="color: var(--dark-blue); font-size: 1.2rem; margin-top: 0; margin-bottom: 1rem;">
                    <i class="fas fa-lock" style="color: var(--primary-blue);"></i> Data Privacy Statement
                </h3>
                
                <p style="margin-bottom: 1rem;">
                    Golden Treasure Baptist Academy is committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy outlines how we collect, use, store, and protect your data in accordance with the <strong>Data Privacy Act of 2012 (Republic Act No. 10173)</strong> of the Philippines.
                </p>
                
                <h4 style="color: var(--dark-blue); font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 0.75rem;">
                    <i class="fas fa-database" style="color: var(--primary-blue); font-size: 0.9rem;"></i> Information We Collect
                </h4>
                <p style="margin-bottom: 1rem;">
                    We collect and process personal information necessary for educational administration, including but not limited to:
                </p>
                <ul style="margin: 0 0 1rem 1.5rem; padding: 0;">
                    <li>Student personal information (name, date of birth, contact details)</li>
                    <li>Guardian/parent information and contact details</li>
                    <li>Academic records, grades, and attendance</li>
                    <li>Financial records related to tuition and payments</li>
                    <li>Teacher and staff employment information</li>
                    <li>User account credentials and activity logs</li>
                </ul>
                
                <h4 style="color: var(--dark-blue); font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 0.75rem;">
                    <i class="fas fa-shield-alt" style="color: var(--primary-blue); font-size: 0.9rem;"></i> How We Protect Your Data
                </h4>
                <p style="margin-bottom: 1rem;">
                    Your personal information will be handled with utmost care and security:
                </p>
                <ul style="margin: 0 0 1rem 1.5rem; padding: 0;">
                    <li><strong>Secure Storage:</strong> All data is stored in secure, encrypted databases</li>
                    <li><strong>Access Control:</strong> Only authorized personnel have access to personal information</li>
                    <li><strong>Confidentiality:</strong> We maintain strict confidentiality protocols</li>
                    <li><strong>Regular Monitoring:</strong> Systems are regularly monitored for security threats</li>
                </ul>
                
                <h4 style="color: var(--dark-blue); font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 0.75rem;">
                    <i class="fas fa-share-alt" style="color: var(--primary-blue); font-size: 0.9rem;"></i> Information Sharing
                </h4>
                <p style="margin-bottom: 1rem;">
                    Your personal information <strong>will not be shared, sold, or disclosed</strong> to third parties except:
                </p>
                <ul style="margin: 0 0 1rem 1.5rem; padding: 0;">
                    <li>When required by law or legal processes</li>
                    <li>With educational authorities for official school purposes</li>
                    <li>With your explicit consent</li>
                    <li>When necessary to protect the safety and security of students and staff</li>
                </ul>
                
                <h4 style="color: var(--dark-blue); font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 0.75rem;">
                    <i class="fas fa-user-check" style="color: var(--primary-blue); font-size: 0.9rem;"></i> Your Rights
                </h4>
                <p style="margin-bottom: 1rem;">
                    Under the Data Privacy Act of 2012, you have the right to:
                </p>
                <ul style="margin: 0 0 1rem 1.5rem; padding: 0;">
                    <li>Be informed about the collection and processing of your data</li>
                    <li>Access your personal information</li>
                    <li>Request correction of inaccurate or incomplete data</li>
                    <li>Object to processing in certain circumstances</li>
                    <li>Request data portability</li>
                    <li>Lodge complaints with the National Privacy Commission</li>
                </ul>
                
                <h4 style="color: var(--dark-blue); font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 0.75rem;">
                    <i class="fas fa-clock" style="color: var(--primary-blue); font-size: 0.9rem;"></i> Data Retention
                </h4>
                <p style="margin-bottom: 1rem;">
                    We retain personal information only for as long as necessary to fulfill the purposes for which it was collected or as required by law and school regulations.
                </p>
                
                <h4 style="color: var(--dark-blue); font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 0.75rem;">
                    <i class="fas fa-phone" style="color: var(--primary-blue); font-size: 0.9rem;"></i> Contact Information
                </h4>
                <p style="margin-bottom: 1rem;">
                    For questions, concerns, or requests regarding your personal information or this Privacy Policy, please contact the school administration.
                </p>
                
                <div style="background: #e7f3ff; border-left: 4px solid var(--primary-blue); padding: 1rem 1.5rem; border-radius: 8px; margin-top: 1.5rem;">
                    <p style="margin: 0; color: var(--dark-blue); font-weight: 600; font-size: 0.9rem;">
                        <i class="fas fa-gavel" style="color: var(--primary-blue);"></i> 
                        By accepting this Privacy Policy, you acknowledge that you have read, understood, and agree to the collection, use, and processing of your personal information as described above in compliance with the Data Privacy Act of 2012.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Footer with Checkbox and Buttons -->
        <div style="padding: 1.5rem 2.5rem 2rem; border-top: 2px solid var(--light-blue);">
            <label style="display: flex; align-items: start; gap: 1rem; cursor: pointer; margin-bottom: 1.5rem; padding: 1rem; background: var(--light-blue); border-radius: 10px;">
                <input type="checkbox" id="privacyPolicyCheckbox" 
                       style="width: 20px; height: 20px; margin-top: 0.2rem; cursor: pointer; accent-color: var(--primary-blue);">
                <span style="color: var(--dark-blue); font-size: 0.95rem; line-height: 1.6;">
                    I have read and agree to the Privacy Policy. I understand how my personal information will be collected, used, and protected in accordance with the Data Privacy Act of 2012.
                </span>
            </label>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button type="button" id="rejectPrivacyPolicy" 
                        style="background: #dc3545; color: white; border: none; padding: 0.875rem 2rem; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s;">
                    <i class="fas fa-times-circle"></i> Decline & Logout
                </button>
                <button type="button" id="acceptPrivacyPolicy" disabled
                        style="background: linear-gradient(135deg, #6c757d, #5a6268); color: white; border: none; padding: 0.875rem 2rem; border-radius: 12px; cursor: not-allowed; font-weight: 600; font-size: 1rem; transition: all 0.3s;">
                    <i class="fas fa-check-circle"></i> Accept & Continue
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Privacy Policy Modal Logic
document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('privacyPolicyCheckbox');
    const acceptBtn = document.getElementById('acceptPrivacyPolicy');
    const rejectBtn = document.getElementById('rejectPrivacyPolicy');
    
    if (!checkbox || !acceptBtn || !rejectBtn) return;
    
    // Enable/disable accept button based on checkbox
    checkbox.addEventListener('change', function() {
        if (this.checked) {
            acceptBtn.disabled = false;
            acceptBtn.style.background = 'linear-gradient(135deg, var(--primary-blue), var(--dark-blue))';
            acceptBtn.style.cursor = 'pointer';
        } else {
            acceptBtn.disabled = true;
            acceptBtn.style.background = 'linear-gradient(135deg, #6c757d, #5a6268)';
            acceptBtn.style.cursor = 'not-allowed';
        }
    });
    
    // Handle accept button click
    acceptBtn.addEventListener('click', function() {
        if (!checkbox.checked) return;
        
        acceptBtn.disabled = true;
        acceptBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        
        fetch('<?php echo $base_url ?? "../"; ?>includes/privacy_policy_handler.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'accept_privacy_policy=1'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('privacyPolicyModal').style.display = 'none';
                window.location.reload();
            } else {
                alert('Error accepting privacy policy. Please try again.');
                acceptBtn.disabled = false;
                acceptBtn.innerHTML = '<i class="fas fa-check-circle"></i> Accept & Continue';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error accepting privacy policy. Please try again.');
            acceptBtn.disabled = false;
            acceptBtn.innerHTML = '<i class="fas fa-check-circle"></i> Accept & Continue';
        });
    });
    
    // Handle reject button click
    rejectBtn.addEventListener('click', function() {
        if (confirm('By declining the Privacy Policy, you will be logged out and cannot access the portal. Are you sure you want to decline?')) {
            fetch('<?php echo $base_url ?? "../"; ?>includes/privacy_policy_handler.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'reject_privacy_policy=1'
            })
            .then(() => {
                window.location.href = '<?php echo $base_url ?? "../"; ?>index.php';
            })
            .catch(() => {
                window.location.href = '<?php echo $base_url ?? "../"; ?>index.php';
            });
        }
    });
});
</script>

<style>
#privacyPolicyModal {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

#rejectPrivacyPolicy:hover {
    background: #c82333;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
}

#acceptPrivacyPolicy:not(:disabled):hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(46, 134, 171, 0.3);
}

#privacyPolicyCheckbox:hover {
    transform: scale(1.1);
}
</style>
